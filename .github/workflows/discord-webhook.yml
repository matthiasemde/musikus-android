name: DISCORD-WEBHOOK

on:
  pull_request:
    types: [opened, reopened]
  release:
    types: [published]

jobs:
  notify-discord:
    name: Notify Discord
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord notification for PR
        if: github.event_name == 'pull_request'
        run: |
          BODY=$(cat <<'EOF'
          ${{ github.event.pull_request.body }}
          EOF
          )
          response=$(curl -s -w "\n%{http_code}" -H "Content-Type: application/json" \
            -X POST \
            -d "$(jq -n --arg title "${{ github.event.pull_request.title }}" \
            --arg url "${{ github.event.pull_request.html_url }}" \
            --arg body "$BODY" \
            --arg branch "${{ github.event.pull_request.head.ref }}" \
            '{"content": "ðŸ“£ **New Pull Request**: [\($title)](\($url))\n\nðŸ“ **Description**: \($body)\n\nðŸš€ **Branch**: \($branch)"}')" \
            ${{ secrets.DISCORD_WEBHOOK_URL }})
          echo "$response"
          response_code=$(echo "$response" | tail -n1)
          if [ "$response_code" -ne 204 ]; then
            echo "Failed to send Discord notification"
            exit 1
          fi

      - name: Send Discord notification for Release
        if: github.event_name == 'release'
        run: |
          BODY=$(cat <<'EOF'
          ${{ github.event.release.body }}
          EOF
          )
          response=$(curl -s -w "%{http_code}" -H "Content-Type: application/json" \
          -X POST \
          -d "$(jq -n --arg title "${{ github.event.release.title }}" \
            --arg url "${{ github.event.release.html_url }}" \
            --arg body "$BODY" \
            --arg tag "${{ github.event.release.tag_name }}" \
            '{"content": "ðŸŽ‰ **New Release**: [\($title)](\($url))\n\nðŸ“¦ **Version**: \($tag)\n\nðŸ“ **Description**: \($body)"}')" \
          ${{ secrets.DISCORD_WEBHOOK_URL }})
          echo "$response"
          response_code=$(echo "$response" | tail -n1)
          if [ "$response_code" -ne 204 ]; then
            echo "Failed to send Discord notification"
            exit 1
          fi
